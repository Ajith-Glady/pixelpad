<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Pixelpad</title>
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-alpha1/dist/css/bootstrap.min.css">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
   <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js">

   <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">   
   <style>
      body {
         background-color: rgb(214, 225, 250)
      }

      .height-100 {
         height: 100vh
      }

      .card {
         width: 400px;
         border: none;
         height: 300px;
         box-shadow: 0px 5px 20px 0px #d2dae3;
         z-index: 1;
         display: flex;
         justify-content: center;
         align-items: center
      }

      .card h6 {
         color: red;
         font-size: 20px
      }

      .inputs input {
         width: 40px;
         height: 40px
      }

      input[type=number]::-webkit-inner-spin-button,
      input[type=number]::-webkit-outer-spin-button {
         -webkit-appearance: none;
         -moz-appearance: none;
         appearance: none;
         margin: 0
      }

      .card-2 {
         background-color: #fff;
         padding: 10px;
         width: 350px;
         height: 100px;
         bottom: -50px;
         left: 20px;
         position: absolute;
         border-radius: 5px
      }

      .card-2 .content {
         margin-top: 50px
      }

      .card-2 .content a {
         color: red
      }

      .form-control:focus {
         box-shadow: none;
         border: 2px solid red
      }

      .validate {
         border-radius: 20px;
         height: 40px;
         background-color: red;
         border: 1px solid red;
         width: 140px
      }
   </style>
</head>

<body>
   <div class="container height-100 d-flex justify-content-center align-items-center">
      <div class="position-relative">
         <form id="submitOtp">
            <div class="card p-4 text-center shadow">
               <h6 class="mb-4">Please enter the one-time password to verify your account</h6>
               <div>
                  <span>A code has been sent to</span>
                  <% if(locals.email) { %>
                     <small class="font-weight-bold">
                        <%= locals.email %>
                     </small>
                  <% } %>
               </div>
               <div id="otp" class="inputs d-flex flex-row justify-content-center mt-4">
                  <input class="m-2 text-center form-control rounded" type="text" id="first" maxlength="1" name="num1"/>
                  <input class="m-2 text-center form-control rounded" type="text" id="second" maxlength="1" name="num2"/>
                  <input class="m-2 text-center form-control rounded" type="text" id="third" maxlength="1" name="num3"/>
                  <input class="m-2 text-center form-control rounded" type="text" id="fourth" maxlength="1" name="num4"/>
               </div>
               <div class="mt-4">
                  <button class="btn btn-danger px-4 validate" type="submit">Validate</button>
               </div>
            </div>
         </form> 
         <div class="card-2 mt-4">
            <div class="content d-flex justify-content-center align-items-center">
               <span>Didn't get the code?</span>
               <a href="/resendOtp" class="text-decoration-none ms-3">Resend</a>
            </div>
         </div>
      </div>
   </div>

   <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
   <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
   <script>
      $(document).ready(function(){
         $('#submitOtp').submit(function(event) {
            event.preventDefault();
            const formData = {
               num1: $('#first').val(),
               num2: $('#second').val(),
               num3: $('#third').val(),
               num4: $('#fourth').val()
            };
            $.ajax({
               url: '/checkOtp',
               type: 'post',
               data: formData,
               success: function(data) {
                  Toastify({
                     text: data.message,
                     duration: 3000,
                     gravity: 'top',
                     position: 'center',
                     style: {
                        background: 'linear-gradient(to right, #00b09b, #96c93d)',
                     },
                     stopOnFocus: true,
                  }).showToast();
                  if(data.success){
                     location.href = '/login'
                  }
               },
               error: function(xhr, textStatus, errorThrown) {
                  console.error('Error:', errorThrown);
                  // You can handle error response here
               }
            });
         });
      });

      const inputs = document.querySelectorAll('.inputs input');
      inputs.forEach((input, index) => {
         input.addEventListener('input', (event) => {
            if (event.target.value.length === 1 && index < inputs.length - 1) {
               inputs[index + 1].focus();
            }
         });
      });
   </script>
</body>
</html>